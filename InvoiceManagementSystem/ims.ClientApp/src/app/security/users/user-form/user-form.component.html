<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">{{ isEdit ? 'Edit User' : 'Create User' }}</h5>
    <a class="btn btn-sm btn-outline-secondary" [routerLink]="['/users']">Back</a>
  </div>
  <div class="card-body">
    <div *ngIf="loading" class="text-muted">Loadingâ€¦</div>
    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
    <form [formGroup]="form" (ngSubmit)="submit()" *ngIf="!loading">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" formControlName="email" placeholder="name@example.com" />
        </div>
        <!-- Removed Display Name: backend requires FirstName/LastName -->
        <div class="col-md-6">
          <label class="form-label">First Name</label>
          <input class="form-control" formControlName="firstName" placeholder="First name" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Last Name</label>
          <input class="form-control" formControlName="lastName" placeholder="Last name" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" formControlName="password" placeholder="Password" />
        </div>
        <div class="col-md-6">
          <label class="form-label" for="status">Status</label>
          <select id="status" class="form-select" formControlName="status" aria-label="User status">
            <option [value]="0">Active</option>
            <option [value]="1">Inactive</option>
          </select>
        </div>
      </div>

      <!-- Role Assignment Section -->
      <div class="row g-3 mt-3" *ngIf="availableRoles.length > 0">
        <div class="col-12">
          <label class="form-label fw-bold">Assign Roles</label>
          <div class="border rounded p-3 role-list-container">
            <div class="form-check" *ngFor="let role of availableRoles">
              <input 
                class="form-check-input" 
                type="checkbox" 
                [id]="'role-' + role.id"
                [title]="role.name"
                placeholder="Select role"
                [checked]="isRoleSelected(role.id)"
                (change)="toggleRole(role.id)">
              <label class="form-check-label" [for]="'role-' + role.id">
                <strong>{{ role.name }}</strong>
                <small class="text-muted d-block" *ngIf="role.description">{{ role.description }}</small>
              </label>
            </div>
            <div *ngIf="availableRoles.length === 0" class="text-muted text-center py-2">
              No roles available
            </div>
          </div>
          <small class="text-muted">Select one or more roles to assign to this user</small>
        </div>
      </div>

      <div class="mt-4">
        <button class="btn btn-primary" type="submit" [disabled]="form.invalid || loading">
          {{ isEdit ? 'Save Changes' : 'Create User' }}
        </button>
      </div>
    </form>
  </div>
</div>
