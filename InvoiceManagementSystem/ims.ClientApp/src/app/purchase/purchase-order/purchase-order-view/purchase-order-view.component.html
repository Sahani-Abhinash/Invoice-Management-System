<div class="invoice-container">
    <!-- Debug Info -->
    <div style="background: #f0f0f0; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc;">
        <strong>Debug Info:</strong><br>
        isLoading: {{ isLoading }}<br>
        error: {{ error }}<br>
        po exists: {{ !!po }}<br>
        po reference: {{ po?.reference }}
    </div>

    <div *ngIf="isLoading" class="text-center p-5">Loading...</div>
    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

    <div *ngIf="!isLoading && po">
        <!-- Toolbar -->
        <div class="d-flex justify-content-end mb-4 no-print gap-2">
            <button class="btn btn-secondary btn-sm" (click)="back()">
                <i class="las la-arrow-left"></i> Back
            </button>
            <button *ngIf="po.isApproved && !po.isClosed" class="btn btn-success btn-sm" (click)="receiveGoods()">
                <i class="las la-truck-loading"></i> Receive Goods
            </button>
            <button class="btn btn-primary btn-sm" (click)="print()">
                <i class="las la-print"></i> Print
            </button>
        </div>

        <!-- Title -->
        <div class="header-title">
            PURCHASE ORDER
        </div>

        <!-- Company Info & Logo -->
        <div class="company-section">
            <div class="company-info">
                <h4>My Company Name LLC</h4>
                <p>123 Business Rd.<br>
                    Tech City, TC 90210<br>
                    Mobile: +1 555-0123<br>
                    Email: info@mycompany.com</p>
            </div>
            <div class="company-logo">
                <i class="las la-shipping-fast text-primary"></i> IMS<span class="text-danger">.</span>
            </div>
        </div>

        <!-- Supplier & PO Meta -->
        <div class="po-details">
            <div class="bill-to">
                <h5 class="mb-2" style="font-weight: 700;">Supplier</h5>
                <div *ngIf="isLoadingDetails" class="text-muted small">Loading supplier info...</div>
                <div *ngIf="!isLoadingDetails && vendor">
                    <p style="font-weight: 600;">{{ vendor.name }}</p>
                    <p>
                        <ng-container *ngIf="vendor.address">
                            {{ vendor.address.line1 }}<br>
                            <ng-container *ngIf="vendor.address.line2">{{ vendor.address.line2 }}<br></ng-container>
                            <ng-container *ngIf="vendor.address.city">{{ vendor.address.city.name }}, </ng-container>
                            <ng-container *ngIf="vendor.address.state">{{ vendor.address.state.name }} </ng-container>
                            <ng-container *ngIf="vendor.address.postalCode">{{ vendor.address.postalCode.code
                                }}</ng-container>
                            <ng-container *ngIf="vendor.address.country"><br>{{ vendor.address.country.name
                                }}</ng-container>
                            <br>
                        </ng-container>
                        <ng-container *ngIf="!vendor.address">No Address Provided<br></ng-container>
                        {{ vendor.email }}<br>
                        {{ vendor.phone }}
                    </p>
                </div>
                <div *ngIf="!isLoadingDetails && !vendor">
                    <p class="text-danger">Vendor information not found (ID: {{ po.vendorId }})</p>
                </div>
            </div>
            <div class="po-meta">
                <table>
                    <tr>
                        <td class="label">PO No :</td>
                        <td><strong>{{ po.reference }}</strong></td>
                    </tr>
                    <tr>
                        <td class="label">Date :</td>
                        <td>{{ po.orderDate | date:'mediumDate' }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Items Table -->
        <table class="items-table">
            <thead>
                <tr>
                    <th style="width: 50px;">Sl.</th>
                    <th>Description</th>
                    <th style="width: 80px; text-align: center;">Qty</th>
                    <th style="width: 120px;">Rate</th>
                    <th style="width: 120px;">Amount</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let line of po.lines; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>
                        <div *ngIf="isLoadingDetails">Loading Item...</div>
                        <div *ngIf="!isLoadingDetails">
                            <span style="font-weight: 500;">{{ getItem(line.itemId)?.name || 'Unknown Item' }}</span>
                            <br>
                            <small class="text-muted">{{ getItem(line.itemId)?.sku || line.itemId }}</small>
                        </div>
                    </td>
                    <td style="text-align: center;">{{ line.quantityOrdered }}</td>
                    <td style="text-align: right;">{{ line.unitPrice | currency }}</td>
                    <td style="text-align: right;">{{ (line.quantityOrdered * line.unitPrice) | currency }}</td>
                </tr>
            </tbody>
        </table>

        <!-- Totals -->
        <div class="totals-section">
            <table class="totals-table">
                <tr>
                    <td class="label">Subtotal</td>
                    <td>{{ totalAmount | currency }}</td>
                </tr>
                <tr class="grand-total">
                    <td class="label">Total</td>
                    <td>{{ totalAmount | currency }}</td>
                </tr>
            </table>
        </div>

        <!-- Footer / Signature -->
        <div class="footer-section">
            <div class="payment-instructions">
                <h6 style="font-weight: 700;">Payment Instructions</h6>
                <p class="text-muted small">
                    Payment within 30 days.<br>
                    Bank: City Bank<br>
                    Acct: 1234567890
                </p>
            </div>
            <div class="signature">
                <div class="signature-line"></div>
                <span class="small" style="font-weight: 600;">Authorized Signatory</span>
            </div>
        </div>
    </div>
</div>