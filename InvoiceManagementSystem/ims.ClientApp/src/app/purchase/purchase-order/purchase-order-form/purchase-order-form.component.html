<div class="invoice-container">
    <form [formGroup]="form" (ngSubmit)="save()">
        <!-- Toolbar -->
        <div class="d-flex justify-content-end mb-4 gap-2 no-print">
            <button type="button" class="btn btn-secondary btn-sm" (click)="cancel()">Cancel</button>
            <button type="submit" class="btn btn-primary btn-sm" [disabled]="form.invalid">
                <i class="las la-save"></i> {{ isEditMode ? 'Update' : 'Save' }} PO
            </button>
        </div>

        <div class="header-title">
            PURCHASE ORDER {{ isEditMode ? '(EDIT)' : '(NEW)' }}
        </div>

        <div class="company-section">
            <div class="company-info">
                <h4>My Company Name LLC</h4>
                <p>123 Business Rd.<br>Tech City, TC 90210</p>
            </div>
            <div class="company-logo">
                <i class="las la-shipping-fast text-primary"></i> IMS<span class="text-danger">.</span>
            </div>
        </div>

        <div class="po-details">
            <div class="bill-to col-md-5">
                <h5>Supplier Details</h5>
                <div class="mb-2">
                    <label class="form-label small">Select Vendor</label>
                    <select class="form-select" formControlName="vendorId">
                        <option value="">-- Select Vendor --</option>
                        <option *ngFor="let v of vendors" [value]="v.id">{{ v.name }}</option>
                    </select>
                </div>
                <div>
                    <label class="form-label small">Ship To Warehouse</label>
                    <select class="form-select" formControlName="warehouseId">
                        <option value="">-- Select Warehouse --</option>
                        <option *ngFor="let w of warehouses" [value]="w.id">{{ w.name }}</option>
                    </select>
                </div>
            </div>
            <div class="po-meta col-md-4">
                <table>
                    <tr>
                        <td class="label">PO Number</td>
                        <td>
                            <input type="text" class="form-control form-control-sm" formControlName="reference"
                                placeholder="PO-0000">
                        </td>
                    </tr>
                    <tr>
                        <td class="label">Date</td>
                        <td>
                            <input type="text" class="form-control form-control-sm"
                                value="{{ (form.get('orderDate')?.value || now) | date:'mediumDate' }}" disabled>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Items Table -->
        <table class="items-table">
            <thead>
                <tr>
                    <th style="width: 5%;">#</th>
                    <th style="width: 40%;">Description / Item</th>
                    <th style="width: 15%; text-align: center;">Qty</th>
                    <th style="width: 20%; text-align: right;">Rate</th>
                    <th style="width: 15%; text-align: right;">Amount</th>
                    <th style="width: 5%;"></th>
                </tr>
            </thead>
            <tbody formArrayName="lines">
                <tr *ngFor="let line of lines.controls; let i=index" [formGroupName]="i">
                    <td>{{ i + 1 }}</td>
                    <td>
                        <select class="form-select form-select-sm" formControlName="itemId">
                            <option value="">Select Item</option>
                            <option *ngFor="let item of items" [value]="item.id">{{ item.name }} ({{ item.sku }})
                            </option>
                        </select>
                    </td>
                    <td>
                        <input type="number" class="form-control form-control-sm text-center"
                            formControlName="quantityOrdered" placeholder="0">
                    </td>
                    <td>
                        <input type="number" class="form-control form-control-sm text-end" formControlName="unitPrice"
                            placeholder="0.00">
                    </td>
                    <td style="text-align: right;">
                        {{ (line.get('quantityOrdered')?.value * line.get('unitPrice')?.value) | currency }}
                    </td>
                    <td>
                        <button type="button" class="btn btn-sm btn-link text-danger" (click)="removeLine(i)">
                            <i class="las la-trash"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="mb-4">
            <button type="button" class="btn btn-sm btn-outline-primary" (click)="addLine()">
                <i class="las la-plus"></i> Add Item
            </button>
        </div>

        <div class="totals-section">
            <table class="totals-table">
                <tr class="grand-total">
                    <td class="label">Total</td>
                    <td>{{ calculateTotal() | currency }}</td>
                </tr>
            </table>
        </div>

    </form>
</div>